<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2G54RXWD4D"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2G54RXWD4D",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="DataHub" href="/opensearch.xml"><title data-react-helmet="true">Metadata Service Developer Guide | DataHub</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Metadata Service Developer Guide | DataHub"><meta data-react-helmet="true" name="description" content="Metadata Service Developer Guide"><meta data-react-helmet="true" property="og:description" content="Metadata Service Developer Guide"><meta data-react-helmet="true" property="og:url" content="https://datahubproject.io/docs/how/build-metadata-service"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://datahubproject.io/docs/how/build-metadata-service"><link rel="stylesheet" href="/styles.35c35aba.css">
<link rel="preload" href="/styles.81989c55.js" as="script">
<link rel="preload" href="/runtime~main.6143fd7e.js" as="script">
<link rel="preload" href="/main.4e7210de.js" as="script">
<link rel="preload" href="/1.f26409b2.js" as="script">
<link rel="preload" href="/95.19bcdc41.js" as="script">
<link rel="preload" href="/98.33210cf8.js" as="script">
<link rel="preload" href="/935f2afb.86ac9836.js" as="script">
<link rel="preload" href="/94.ad115ef1.js" as="script">
<link rel="preload" href="/dffa9333.bf4b62a7.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo-color.png" alt="DataHub Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo-dark.png" alt="DataHub Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">DataHub</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="http://slack.datahubproject.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Slack</a><a class="navbar__item navbar__link" href="/docs/demo">Demo</a><a href="https://github.com/linkedin/datahub" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">‚åò</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo-color.png" alt="DataHub Logo" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo-dark.png" alt="DataHub Logo" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">DataHub</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="http://slack.datahubproject.io" target="_blank" rel="noopener noreferrer" class="menu__link">Slack</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/demo">Demo</a></li><li class="menu__list-item"><a href="https://github.com/linkedin/datahub" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">DataHub</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/faq">FAQs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/features">Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contributing">Contributing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/demo">Demo</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/quickstart">Quickstart Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/debugging">Debugging Guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/architecture/architecture">Architecture Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/architecture/metadata-ingestion">Metadata Ingestion Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/architecture/metadata-serving">Serving Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datahub-web-react">React App</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Metadata Modeling</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/what/entity">Entities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/what/aspect">What is a metadata aspect?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/what/urn">What is URN?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/what/relationship">What is a relationship?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/what/search-document">What is a search document?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/what/snapshot">What is a snapshot?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/what/delta">What is a metadata delta?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/what/mxe">What is MXE (Metadata Events)?</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Developer Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developers">Developer&#x27;s Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/docker/development">Using Docker Images During Development</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/what/graph">What is GMA graph?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/what/search-index">What is GMA search index?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how/add-new-aspect">How to add a new metadata aspect?</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/how/build-metadata-service">Metadata Service Developer Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how/customize-elasticsearch-query-template">How to customize the search experience of an entity?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how/entity-onboarding">How to onboard an entity?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how/graph-onboarding">How to onboard to GMA graph?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how/metadata-modelling">How to model metadata ?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/demo/graph-onboarding">Onboarding to GMA Graph - Adding a new relationship type</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how/search-onboarding">How to onboard to GMA search?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how/search-over-new-field">Onboarding to GMA Search - searching over a new field</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how/configure-oidc-react">OIDC Authentication in React</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how/sso/configure-oidc-react-google">Configuring Google Authentication for React App (OIDC)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how/sso/configure-oidc-react-okta">Configuring Okta Authentication for React App (OIDC)</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Components</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datahub-web-react">React App</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datahub-frontend">Frontend</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datahub-graphql-core">GraphQL Core</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/gms">Generalized Metadata Store (GMS)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/datahub-gms-graphql-service">GMS GraphQL Service</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/metadata-jobs/mae-consumer-job">MetadataAuditEvent (MAE) Consumer Job</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/metadata-jobs/mce-consumer-job">MetadataChangeEvent (MCE) Consumer Job</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/metadata-ingestion">Metadata Ingestion</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Advanced Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/advanced/aspect-versioning">Aspect Versioning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/advanced/es-7-upgrade">Elasticsearch upgrade from 5.6.8 to 7.9.3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/advanced/high-cardinality">High Cardinality Relationships</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/how/scsi-onboarding-guide">Strongly Consistent Secondary Index</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deployment</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/how/kafka-config">Configuring Kafka</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/docker">Deploying with Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/contrib/kubernetes">Deploying with Kubernetes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/slack">Slack</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/links">Articles &amp; Talks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/townhalls">Town Halls</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/townhall-history">Town Hall History</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/code_of_conduct">Contributor Covenant Code of Conduct</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc">RFC Process</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">RFCs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/1778-dashboards">Dashboards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/1812-ml_models">Machine Learning Models</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/1820-azkaban-flow-job">Azkaban Flows and Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/1841-lineage/field_level_lineage">RFC - Field Level Lineage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/1842-business_glossary">Business Glossary</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/2042-graphql_frontend/queries">GraphQL Frontend (Part 1)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/2055-react-app">Proposal to Incubate a new React Application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/rfc/active/tags">Tags</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="metadata-service-developer-guide"></a>Metadata Service Developer Guide<a class="hash-link" href="#metadata-service-developer-guide" title="Direct link to heading">#</a></h1><p>This guide assumes that you are already familar with the architecture of DataHub&#x27;s Metadata Serving Layer, as described <a href="/docs/architecture/metadata-serving">here</a>. </p><p>Read on to understand how to build and extend the DataHub service tier for your specific needs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-daos-to-store-and-query-metadata"></a>Using DAOs to store and query Metadata<a class="hash-link" href="#using-daos-to-store-and-query-metadata" title="Direct link to heading">#</a></h2><p>DataHub metadata service uses the excellent <code>datahub-gma</code> library to store and query metadata in a standard way.
There are four types of Data Access Objects (<a href="https://en.wikipedia.org/wiki/Data_access_object" target="_blank" rel="noopener noreferrer">DAO</a>) that standardize the way metadata is accessed.
This section describes each type of DAO, its purpose, and the interface. </p><p>These DAOs rely heavily on <a href="https://docs.oracle.com/javase/tutorial/extra/generics/index.html" target="_blank" rel="noopener noreferrer">Java Generics</a> so that the core logics can remain type-neutral.
However, as there‚Äôs no inheritance in <a href="https://linkedin.github.io/rest.li/DATA-Data-Schema-and-Templates" target="_blank" rel="noopener noreferrer">Pegasus</a>, the generics often fallback to extending <a href="https://github.com/linkedin/rest.li/blob/master/data/src/main/java/com/linkedin/data/template/RecordTemplate.java" target="_blank" rel="noopener noreferrer">RecordTemplate</a> instead of the desired types (i.e. <a href="/docs/what/entity">entity</a>, <a href="/docs/what/relationship">relationship</a>, metadata <a href="/docs/what/aspect">aspect</a> etc). Additional runtime type checking has been added to the DAOs to avoid binding to unexpected types. We also cache the type checking result to minimize runtime overhead.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="key-value-dao-local-dao"></a>Key-value DAO (Local DAO)<a class="hash-link" href="#key-value-dao-local-dao" title="Direct link to heading">#</a></h3><p><a href="/docs/what/gms">GMS</a> use <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/java/com/linkedin/metadata/dao/BaseLocalDAO.java" target="_blank" rel="noopener noreferrer">Local DAO</a> to store and retrieve metadata <a href="/docs/what/aspect">aspect</a>s from the local document store.
Below shows the base class and its simple key-value interface.
As the DAO is a generic class, it needs to be bound to specific type during instantiation.
Each entity type will need to instantiate its own version of DAO.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-java codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract class BaseLocalDAO&lt;ASPECT extends UnionTemplate&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;URN extends Urn, METADATA extends RecordTemplate&gt; void </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  add(Class&lt;METADATA&gt; type, URN urn, METADATA value);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;URN extends Urn, METADATA extends RecordTemplate&gt; </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Optional&lt;METADATA&gt; get(Class&lt;METADATA&gt; type, URN urn, int version);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;URN extends Urn, METADATA extends RecordTemplate&gt; </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ListResult&lt;Integer&gt; listVersions(Class&lt;METADATA&gt; type, URN urn, int start, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    int pageSize);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;METADATA extends RecordTemplate&gt; ListResult&lt;Urn&gt; listUrns( </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Class&lt;METADATA&gt; type, int start, int pageSize);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;URN extends Urn, METADATA extends RecordTemplate&gt; </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ListResult&lt;METADATA&gt; list(Class&lt;METADATA&gt; type, URN urn, int start, int pageSize);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Another important function of <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/java/com/linkedin/metadata/dao/BaseLocalDAO.java" target="_blank" rel="noopener noreferrer">Local DAO</a> is to automatically emit <a href="/docs/what/mxe#metadata-audit-event-mae">MAE</a>s whenever the metadata is updated.
This is doable because MAE effectively use the same <a href="https://linkedin.github.io/rest.li/DATA-Data-Schema-and-Templates" target="_blank" rel="noopener noreferrer">Pegasus</a> models so <a href="https://github.com/linkedin/rest.li/blob/master/data/src/main/java/com/linkedin/data/template/RecordTemplate.java" target="_blank" rel="noopener noreferrer">RecordTemplate</a> can be easily converted into the corresponding <a href="https://github.com/apache/avro/blob/master/lang/java/avro/src/main/java/org/apache/avro/generic/GenericRecord.java" target="_blank" rel="noopener noreferrer">GenericRecord</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="search-dao"></a>Search DAO<a class="hash-link" href="#search-dao" title="Direct link to heading">#</a></h3><p>Search DAO is also a generic class that can be bound to a specific type of search document.
The DAO provides 3 APIs:</p><ul><li>A <code>search</code> API that takes the search input, a <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/pegasus/com/linkedin/metadata/query/Filter.pdl" target="_blank" rel="noopener noreferrer">Filter</a>, a <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/pegasus/com/linkedin/metadata/query/SortCriterion.pdl" target="_blank" rel="noopener noreferrer">SortCriterion</a>, some pagination parameters, and returns a <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/java/com/linkedin/metadata/dao/SearchResult.java" target="_blank" rel="noopener noreferrer">SearchResult</a>. </li><li>An <code>autoComplete</code> API which allows typeahead-style autocomplete based on the current input and a <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/pegasus/com/linkedin/metadata/query/Filter.pdl" target="_blank" rel="noopener noreferrer">Filter</a>, and returns <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/pegasus/com/linkedin/metadata/query/AutoCompleteResult.pdl" target="_blank" rel="noopener noreferrer">AutocompleteResult</a>.</li><li>A <code>filter</code> API which allows for filtering only without a search input. It takes a a <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/pegasus/com/linkedin/metadata/query/Filter.pdl" target="_blank" rel="noopener noreferrer">Filter</a> and a <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/pegasus/com/linkedin/metadata/query/SortCriterion.pdl" target="_blank" rel="noopener noreferrer">SortCriterion</a> as input and returns <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/java/com/linkedin/metadata/dao/SearchResult.java" target="_blank" rel="noopener noreferrer">SearchResult</a>.</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-java codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract class BaseSearchDAO&lt;DOCUMENT extends RecordTemplate&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public abstract SearchResult&lt;DOCUMENT&gt; search(String input, Filter filter, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SortCriterion sortCriterion, int from, int size);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public abstract AutoCompleteResult autoComplete(String input, String field,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Filter filter, int limit);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public abstract SearchResult&lt;DOCUMENT&gt; filter(Filter filter, SortCriterion sortCriterion, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        int from, int size);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="query-dao"></a>Query DAO<a class="hash-link" href="#query-dao" title="Direct link to heading">#</a></h3><p>Query DAO allows clients, e.g. <a href="/docs/what/gms">GMS</a>, <a href="/docs/architecture/metadata-serving#metadata-index-applier-mae-consumer-job">MAE Consumer Job</a> etc, to perform both graph &amp; non-graph queries against the metadata graph.
For instance, a GMS can use the Query DAO to find out ‚Äúall the dataset owned by the users who is part of the group <code>foo</code> and report to <code>bar</code>,‚Äù which naturally translates to a graph query.
Alternatively, a client may wish to retrieve ‚Äúall the datasets that stored under /jobs/metrics‚Äù, which doesn‚Äôt involve any graph traversal.</p><p>Below is the base class for Query DAOs, which contains the <code>findEntities</code> and <code>findRelationships</code> methods.
Both methods also have two versions, one involves graph traversal, and the other doesn‚Äôt.
You can use <code>findMixedTypesEntities</code> and <code>findMixedTypesRelationships</code> for queries that return a mixture of different types of entities or relationships.
As these methods return a list of <a href="https://github.com/linkedin/rest.li/blob/master/data/src/main/java/com/linkedin/data/template/RecordTemplate.java" target="_blank" rel="noopener noreferrer">RecordTemplate</a>, callers will need to manually cast them back to the specific entity type using <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#isInstance-java.lang.Object-" target="_blank" rel="noopener noreferrer">isInstance()</a> or reflection.</p><p>Note that the generics (ENTITY, RELATIONSHIP) are purposely left untyped, as these types are native to the underlying graph DB and will most likely differ from one implementation to another.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-java codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract class BaseQueryDAO&lt;ENTITY, RELATIONSHIP&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;ENTITY extends RecordTemplate&gt; List&lt;ENTITY&gt; findEntities(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Class&lt;ENTITY&gt; type, Filter filter, int offset, int count);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;ENTITY extends RecordTemplate&gt; List&lt;ENTITY&gt; findEntities(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Class&lt;ENTITY&gt; type, Statement function);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract List&lt;RecordTemplate&gt; findMixedTypesEntities(Statement function);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;ENTITY extends RecordTemplate, RELATIONSHIP extends RecordTemplate&gt; List&lt;RELATIONSHIP&gt; </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  findRelationships(Class&lt;ENTITY&gt; entityType, Class&lt;RELATIONSHIP&gt; relationshipType, Filter filter, int offset, int count);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;RELATIONSHIP extends RecordTemplate&gt; List&lt;RELATIONSHIP&gt; </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  findRelationships(Class&lt;RELATIONSHIP&gt; type, Statement function);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract List&lt;RecordTemplate&gt; findMixedTypesRelationships(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Statement function);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="remote-dao"></a>Remote DAO<a class="hash-link" href="#remote-dao" title="Direct link to heading">#</a></h3><p><a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/java/com/linkedin/metadata/dao/BaseRemoteDAO.java" target="_blank" rel="noopener noreferrer">Remote DAO</a> is nothing but a specialized readonly implementation of <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/java/com/linkedin/metadata/dao/BaseLocalDAO.java" target="_blank" rel="noopener noreferrer">Local DAO</a>.
Rather than retrieving metadata from a local storage, Remote DAO will fetch the metadata from another <a href="/docs/what/gms">GMS</a>.
The mapping between <a href="/docs/what/entity">entity</a> type and GMS is implemented as a hard-coded map.</p><p>To prevent circular dependency (<a href="https://rest.li" target="_blank" rel="noopener noreferrer">rest.li</a> service depends on remote DAO, which in turn depends on rest.li client generated by each rest.li service),
Remote DAO will need to construct raw rest.li requests directly, instead of using each entity‚Äôs rest.li request builder.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="customizing-search-and-graph-index-updates"></a>Customizing Search and Graph Index Updates<a class="hash-link" href="#customizing-search-and-graph-index-updates" title="Direct link to heading">#</a></h2><p>In addition to storing and querying metadata, a common requirement is to customize and extend the fields that are being stored in the search or the graph index. </p><p>As described in <a href="/docs/how/metadata-modelling">Metadata Modelling</a> section, <a href="/docs/what/entity">Entity</a>, <a href="/docs/what/relationship">Relationship</a>, and <a href="/docs/what/search-document">Search Document</a> models do not directly encode the logic of how each field should be derived from metadata.
Instead, this logic needs to be provided in the form of a Java class: a graph or search index builder.</p><p>The builders register the <a href="/docs/what/aspect">metadata aspect</a>s of their interest against <a href="#mae-consumer-job">MAE Consumer Job</a> and will be invoked whenever a MAE involving the corresponding aspect is received.
If the MAE itself doesn‚Äôt contain all the metadata needed, builders can use Remote DAO to fetch from GMS directly.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-java codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract class BaseIndexBuilder&lt;DOCUMENT extends RecordTemplate&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> BaseIndexBuilder(@Nonnull List&lt;Class&lt;? extends RecordTemplate&gt;&gt; snapshotsInterested);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> @Nullable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract List&lt;DOCUMENT&gt; getDocumentsToUpdate(@Nonnull RecordTemplate snapshot);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> @Nonnull</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract Class&lt;DOCUMENT&gt; getDocumentType();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-java codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public interface GraphBuilder&lt;SNAPSHOT extends RecordTemplate&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> GraphUpdates build(SNAPSHOT snapshot);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> @Value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> class GraphUpdates {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   List&lt;? extends RecordTemplate&gt; entities;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   List&lt;RelationshipUpdates&gt; relationshipUpdates;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> @Value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> class RelationshipUpdates {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   List&lt;? extends RecordTemplate&gt; relationships;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   BaseGraphWriterDAO.RemovalOption preUpdateOperation;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/linkedin/datahub/blob/master/docs/how/build-metadata-service.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/how/add-new-aspect"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ How to add a new metadata aspect?</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/how/customize-elasticsearch-query-template"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How to customize the search experience of an entity? ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#using-daos-to-store-and-query-metadata" class="table-of-contents__link">Using DAOs to store and query Metadata</a><ul><li><a href="#key-value-dao-local-dao" class="table-of-contents__link">Key-value DAO (Local DAO)</a></li><li><a href="#search-dao" class="table-of-contents__link">Search DAO</a></li><li><a href="#query-dao" class="table-of-contents__link">Query DAO</a></li><li><a href="#remote-dao" class="table-of-contents__link">Remote DAO</a></li></ul></li><li><a href="#customizing-search-and-graph-index-updates" class="table-of-contents__link">Customizing Search and Graph Index Updates</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/quickstart">Quickstart</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/features">Features</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/faq">FAQs</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="http://slack.datahubproject.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC3qFQC5IiwR5fvWEqi_tJ5w" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/townhalls">Town Halls</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/#adoption">Adoption</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/demo">Demo</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/roadmap">Roadmap</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/contributing">Contributing</a></li><li class="footer__item"><a href="https://github.com/linkedin/datahub" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright ¬© 2015-2021 DataHub Project Authors.</div></div></div></footer></div>
<script src="/styles.81989c55.js"></script>
<script src="/runtime~main.6143fd7e.js"></script>
<script src="/main.4e7210de.js"></script>
<script src="/1.f26409b2.js"></script>
<script src="/95.19bcdc41.js"></script>
<script src="/98.33210cf8.js"></script>
<script src="/935f2afb.86ac9836.js"></script>
<script src="/94.ad115ef1.js"></script>
<script src="/dffa9333.bf4b62a7.js"></script>
</body>
</html>